---
title: "東京アメッシュをコマンドラインから利用できるツール ramesh を作った"
date: 2013-07-15T21:28:50+09:00
tags: ["hatenablog"]
---

昨日は多摩の方まで走りに行ったら、帰りがけにゲリラ豪雨にあってしまった。尾根幹の陸橋下で30分くらい雨宿りしとった。

東京都下水道局が提供する[東京アメッシュ](http://tokyo-ame.jwa.or.jp/index.html)という素晴らしいサービスが有る。現在から2時間前までの5分間隔で、南関東一帯の降水量を確認することができる。特に都内の観測範囲は緻密。ゲリラ豪雨が発生するとその地点が局地的に赤くなるので、「ゲリラ豪雨が近づいてきそうだ」という予測を立てるのも容易。

で、この素晴らしきサービスをコマンドラインから利用できるツール **ramesh** を作った。アメッシュ確認するのに一々ブラウザ開きたくない人ご利用ください。

## なにこれ
東京アメッシュが提供している降水量レーダー画像をダウンロードするツール。現在の画像はもちろん、過去に遡っての画像取得も可能。

## インストール
ImageMagick が必要。画像合成処理をしているので。

ramesh は gem として公開しているので普通に

    $ gem install ramesh

でインストールできる。

## つかいかた
引数を指定しないと、現在のレーダー画像をダウンロードする。

    $ ramesh

過去の画像を取得することもできる。分は0-120の間、5分単位で指定する必要がある。以下の例だと90分前の画像をダウンロードする。

    $ ramesh 90


範囲を指定して、複数枚の画像を取得することもできる。以下の例だと50分前から120分前まで5分間隔で、合計15枚の画像をダウンロードする。

    $ ramesh 50-120

## ソースコード

[github - dtan4/ramesh](https://github.com/dtan4/ramesh)

## 技術情報
ブラウザに表示されるアメッシュのレーダー画像は、3枚の画像が重なりあったものである。上から順に、

* 都県名・都県境の画像 /map/msk000.png
* 降水量メッシュ画像 /mesh/000/yyyyMMddhhmm.gif
* 地形図 /map/map000.png

このうち、上2つは背景透過がなされているので、重ねるといい具合に表示できる。ramesh は3枚それぞれをダウンロードしてきて、それらを合成したものを1枚の gif として保存している。

また、現在アメッシュのサーバに保存されているメッシュ画像の一覧は以下の JavaScript ファイルに書いてある。これをパースすれば画像ファイル名をとれる。

http://tokyo-ame.jwa.or.jp/scripts/mesh_index.js

## 余談
今は自宅鯖で ramesh を cron で回してデータ蓄積しとる。10日間で3300枚、770MB 超。時折溜めた分引っ張ってきてパラパラ漫画見たくアニメーション作ったりしとる。

初めての gem なので、先人の書いた gem を色々参考にしながら書いてみた。とりあえず大体の流れはつかめた感じ。
