<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>nginx on blog-ja.dtan4.net</title><link>http://blog-ja.dtan4.net/tags/nginx/</link><description>Recent content in nginx on blog-ja.dtan4.net</description><generator>Hugo -- gohugo.io</generator><language>ja-JP</language><copyright>Copyright &amp;copy; 2020 dtan4 All Rights Reserved</copyright><lastBuildDate>Fri, 12 Dec 2014 00:00:00 +0000</lastBuildDate><atom:link href="http://blog-ja.dtan4.net/tags/nginx/index.xml" rel="self" type="application/rss+xml"/><item><title>nginx.conf で環境変数を読み込む</title><link>http://blog-ja.dtan4.net/posts/qiita-0fe6cca5487698afa68c/</link><pubDate>Fri, 12 Dec 2014 00:00:00 +0000</pubDate><guid>http://blog-ja.dtan4.net/posts/qiita-0fe6cca5487698afa68c/</guid><description>この記事はQiitaの記事をエクスポートしたものです。内容が古くなっている可能性があります。
Docker container で nginx を起動するときとか、nginx.conf で何かしらのパラメータを動的に設定したいことがあると思います。server_name とか。 今回は nginx.conf で何とかして環境変数を読み込む手法を紹介します。
TL;DR __env ディレクティブ__と ngx_http_perl_module (or lua_nginx_module) を使って、環境変数を nginx 変数に設定する。
Example server_name を環境変数 SERVER_NAME から動的に読み込む例を示します。
user nginx; worker_processes 4; env SERVER_NAME; http { perl_set $server_name_from_env &amp;#39;sub { return $ENV{&amp;#34;SERVER_NAME&amp;#34;}; }&amp;#39;; # ... server { server_name $server_name_from_env; # ... } } こうしておけば、docker run -e SERVER_NAME=hoge.example.com hoge/nginx みたいに都度 SERVER_NAME を設定できます。
くわしく nginx は起動時に親プロセスの環境変数を引き継ぎません。ですが、env ディレクティブを使えば特定の環境変数を nginx に引き継がせることができます。 env ディレクティブは main コンテキスト、つまり user とかと同じ階層でのみ宣言できます。</description></item></channel></rss>